$(document).bind("ajaxSend",function(){$("#loading").show()}).bind("ajaxComplete",function(){$("#loading").hide()}).bind("ajaxError",function(){$("#fail").show()}),function(l){var r=new Array,i=new Array,o=new Array,a=new FormData,n=new Array("jpg","png","jpeg","gif","m4a"),f=0,t=function(){return"replace"!=l("#renametype").val()&&("add"!=l("#renametype").val()&&("format"==l("#renametype").val()||void 0))},e=l("#sortable")[0];Sortable.create(e,{handle:".glyphicon-move",animation:100,onEnd:function(e){var a=e.newIndex,t=e.oldIndex;o.splice(a,0,o.splice(t,1)[0]),d()}}),l("#renametype, #toreplace, #replace, #add, #addplace, #format, #number, #formatkind, #formatplace, #sortable").on("keyup change",function(){d()});var d=function(){if("replace"==l("#renametype").val()){var i=l("#toreplace").val(),n=l("#replace").val();l(".filename").each(function(){var e=l(this).attr("filename"),a="."+e.split(".").pop(),t=e.slice(0,-a.length);l(this).text(t.replace(i,n)+a)})}else if("add"==l("#renametype").val()){var r=l("#add").val();l(".filename").each(function(){var e=l(this).attr("filename"),a="."+e.split(".").pop();if("after"==l("#addplace").val()){var t=e.slice(0,-a.length);l(this).text(t+r+a)}else l(this).text(r+e)})}else if("format"==l("#renametype").val()){var a=l("#format").val(),t=l("#number").val();l(".filename").each(function(){var e="."+l(this).attr("filename").split(".").pop();"counter"==l("#formatkind").val()&&(t=function(e,a){for(var t=""+e;t.length<a;)t="0"+t;return t}(t,5)),"after"==l("#formatplace").val()?l(this).text(a+t+e):l(this).text(t+a+e),t++})}};function s(e){for(var a=e.split(".").pop().toLowerCase(),t=0;t<=n.length;t++)if(n[t]==a)return!0;return!1}var c=function(e,a){var t=l("#file").prop("files")[e].name;i.push(l("#file")[0].files[e]),l("#error").parent().attr("data-visibility","visible"),l("#error").append('<div class="file fail">'+t+" "+a+"</div>")},p=function(){0!==r.length&&l("#sortable").html("").parent().attr("data-visibility","visible");for(var e=0;e<r.length;e++)1==t()?l("#sortable").append('<div class="file success" delete_id="'+o[e].delete_id+'"><div class="glyphicon glyphicon-move" aria-hidden="true"><p>:::</p></div><img src="'+URL.createObjectURL(o[e])+'" style="margin-left: 20px" alt="'+o[e].name+'"><div class="filename sortable" filename="'+o[e].name+'">'+o[e].name+'</div><div class="delete" data-status="off"><p>X</p></div></div>'):l("#sortable").append('<div class="file success" delete_id="'+r[e].delete_id+'"><img src="'+URL.createObjectURL(r[e])+'" alt="'+r[e].name+'"><div class="filename" filename="'+r[e].name+'">'+r[e].name+'</div><div class="delete" data-status="off"><p>X</p></div></div>');d()},m=function(e){""!==e.text()?e.parent().attr("data-visibility","visible"):e.parent().attr("data-visibility","hidden")},v=function(){l(".delete").off().on("click",function(){var a=parseInt(l(this).parent().attr("delete_id"));r=r.filter(function(e){return e.delete_id!==a}),o=o.filter(function(e){return e.delete_id!==a}),l(this).parent().remove(),l("#file")[0].value="",d(),m(l("#sortable"))})};l(".clear.all").on("click",function(){r=new Array,o=new Array,l(".file.success").remove(),l(".file.fail").remove(),l("#file")[0].value="",m(l("#sortable")),m(l("#error"))}),l(".clear.error").on("click",function(){l(".file.fail").remove(),m(l("#error"))});l("#upload").change(function(){!function(){for(var e=l("#file")[0].files.length,a=0;a<e;a++){var t=r.length,i=l("#file").prop("files")[a].name,n=l("#file")[0].files[a].size;1==s(i)?1e8<=n?c(a,"ist too big"):0==n?c(a,"has Zero byte"):(r.push(l("#file")[0].files[a]),o.push(l("#file")[0].files[a]),r[t].delete_id=f,o[t].delete_id=f):c(a,"wrong filetype"),f++}}(),p(),v(),d()}),l("#renametype").change(function(){"replace"==this.value?(l('[name="addform"], [name="formatform"]').attr("data-visibility","hidden"),l('[name="replaceform"]').attr("data-visibility","visible")):"add"==this.value?(l('[name="replaceform"], [name="formatform"]').attr("data-visibility","hidden"),l('[name="addform"]').attr("data-visibility","visible")):"format"==this.value&&(l('[name="replaceform"], [name="addform"]').attr("data-visibility","hidden"),l('[name="formatform"]').attr("data-visibility","visible")),p(),v(),d()}),l("#submit").on("click",function(e){e.preventDefault(),function(){1==t()&&(r=o);for(var e=0;e<r.length;e++)new_name=l("[delete_id="+r[e].delete_id+"]").children(".filename").text(),a.append("file_upload[]",r[e],new_name)}(),l.ajax({url:"inc/upload.php",dataType:"html",cache:!1,contentType:!1,processData:!1,data:a,type:"post",success:function(e){window.location.href="download/"+e},error:function(e){l("#error").html(e),alert(e)}}),a=new FormData})}(jQuery);