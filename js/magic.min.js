!function(n){var l=new Array,i=new Array,o=new Array,a=new FormData,r=new Array("jpg","png","jpeg","gif","m4a"),f=0,t=function(){return"replace"!=n("#renametype").val()&&("add"!=n("#renametype").val()&&("format"==n("#renametype").val()||void 0))},e=n("#sortable")[0];Sortable.create(e,{handle:".glyphicon-move",animation:100,onEnd:function(e){var a=e.newIndex,t=e.oldIndex;o.splice(a,0,o.splice(t,1)[0]),d()}}),n("#renametype, #toreplace, #replace, #add, #addplace, #format, #number, #formatkind, #formatplace, #sortable").on("keyup change",function(){d()});var d=function(){if("replace"==n("#renametype").val()){var i=n("#toreplace").val(),r=n("#replace").val();n(".filename").each(function(){var e=n(this).attr("filename"),a="."+e.split(".").pop(),t=e.slice(0,-a.length);n(this).text(t.replace(i,r)+a)})}else if("add"==n("#renametype").val()){var l=n("#add").val();n(".filename").each(function(){var e=n(this).attr("filename"),a="."+e.split(".").pop();if("after"==n("#addplace").val()){var t=e.slice(0,-a.length);n(this).text(t+l+a)}else n(this).text(l+e)})}else if("format"==n("#renametype").val()){var a=n("#format").val(),t=n("#number").val();n(".filename").each(function(){var e="."+n(this).attr("filename").split(".").pop();"counter"==n("#formatkind").val()&&(t=function(e,a){for(var t=""+e;t.length<a;)t="0"+t;return t}(t,5)),"after"==n("#formatplace").val()?n(this).text(a+t+e):n(this).text(t+a+e),t++})}};function s(e){for(var a=e.split(".").pop().toLowerCase(),t=0;t<=r.length;t++)if(r[t]==a)return!0;return!1}var c=function(e,a){var t=n("#file").prop("files")[e].name;i.push(n("#file")[0].files[e]),n("#error").parent().attr("data-visibility","visible"),n("#error").append('<div class="file fail">'+t+" "+a+"</div>")},p=function(){0!==l.length&&n("#sortable").html("").parent().attr("data-visibility","visible");for(var e=0;e<l.length;e++)1==t()?n("#sortable").append('<div class="file success" delete_id="'+o[e].delete_id+'"><div class="glyphicon glyphicon-move" aria-hidden="true"><p>:::</p></div><img src="'+URL.createObjectURL(o[e])+'" style="margin-left: 20px" alt="'+o[e].name+'"><div class="filename sortable" filename="'+o[e].name+'">'+o[e].name+'</div><div class="delete" data-status="off"><p>X</p></div></div>'):n("#sortable").append('<div class="file success" delete_id="'+l[e].delete_id+'"><img src="'+URL.createObjectURL(l[e])+'" alt="'+l[e].name+'"><div class="filename" filename="'+l[e].name+'">'+l[e].name+'</div><div class="delete" data-status="off"><p>X</p></div></div>');d()},m=function(e){""!==e.text()?e.parent().attr("data-visibility","visible"):e.parent().attr("data-visibility","hidden")},v=function(){n(".delete").off().on("click",function(){var a=parseInt(n(this).parent().attr("delete_id"));l=l.filter(function(e){return e.delete_id!==a}),o=o.filter(function(e){return e.delete_id!==a}),n(this).parent().remove(),n("#file")[0].value="",d(),m(n("#sortable"))})};n(".clear.all").on("click",function(){l=new Array,o=new Array,n(".file.success").remove(),n(".file.fail").remove(),n("#file")[0].value="",m(n("#sortable")),m(n("#error"))}),n(".clear.error").on("click",function(){n(".file.fail").remove(),m(n("#error"))});n("#upload").change(function(){!function(){for(var e=n("#file")[0].files.length,a=0;a<e;a++){var t=l.length,i=n("#file").prop("files")[a].name,r=n("#file")[0].files[a].size;1==s(i)?1e8<=r?c(a,"ist too big"):0==r?c(a,"has Zero byte"):(l.push(n("#file")[0].files[a]),o.push(n("#file")[0].files[a]),l[t].delete_id=f,o[t].delete_id=f):c(a,"wrong filetype"),f++}}(),p(),v(),d()}),n("#renametype").change(function(){"replace"==this.value?(n('[name="addform"], [name="formatform"]').attr("data-visibility","hidden"),n('[name="replaceform"]').attr("data-visibility","visible")):"add"==this.value?(n('[name="replaceform"], [name="formatform"]').attr("data-visibility","hidden"),n('[name="addform"]').attr("data-visibility","visible")):"format"==this.value&&(n('[name="replaceform"], [name="addform"]').attr("data-visibility","hidden"),n('[name="formatform"]').attr("data-visibility","visible")),p(),v(),d()}),n("#submit").on("click",function(e){e.preventDefault(),function(){1==t()&&(l=o);for(var e=0;e<l.length;e++)new_name=n("[delete_id="+l[e].delete_id+"]").children(".filename").text(),a.append("file_upload[]",l[e],new_name)}(),n.ajax({url:"inc/upload.php",dataType:"html",cache:!1,contentType:!1,processData:!1,data:a,type:"post",success:function(e){window.location.href="download/"+e},error:function(e){n("#error").html(e)}}),a=new FormData})}(jQuery);